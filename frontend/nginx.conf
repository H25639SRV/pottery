# Nginx l√† Web Server ƒë·ªÉ ph·ª•c v·ª• c√°c file tƒ©nh c·ªßa Frontend (React/Vue build)
# ƒê·ªìng th·ªùi ƒë√≥ng vai tr√≤ Reverse Proxy ƒë·ªÉ chuy·ªÉn h∆∞·ªõng c√°c request API ƒë·∫øn Backend.

server {
    listen 80;
    
    # Th√™m t√™n mi·ªÅn c·ªßa b·∫°n ƒë·ªÉ Nginx bi·∫øt x·ª≠ l√Ω request n√†y
    server_name mocgom.io.vn www.mocgom.io.vn; 
    
    # Root th∆∞ m·ª•c ch·ª©a c√°c file tƒ©nh c·ªßa Frontend
    root /usr/share/nginx/html;
    index index.html;

    # C·∫•u h√¨nh Timeout
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;

    # C·∫•u h√¨nh Proxy Reverse cho t·∫•t c·∫£ c√°c API call
    location /api/ {
        # T√™n service 'backend' trong Docker Compose ƒë∆∞·ª£c t·ª± ƒë·ªông ph√¢n gi·∫£i th√†nh IP c·ªßa container Backend.
        proxy_pass http://backend:5000;
        
        # Thi·∫øt l·∫≠p c√°c headers c·∫ßn thi·∫øt cho giao ti·∫øp API
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # NgƒÉn ch·∫∑n Nginx cache ph·∫£n h·ªìi API
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        proxy_cache_bypass $http_pragma;
    }
    
    # üì¢ C·∫§U H√åNH SOCKET.IO PROXY (N·∫øu Socket.io ch·∫°y qua c·ªïng 80)
    # V√¨ Frontend c·ªßa b·∫°n d√πng Socket.io, Nginx c·∫ßn h·ªó tr·ª£ WebSockets
    location /socket.io {
        proxy_pass http://backend:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }


    # C·∫•u h√¨nh x·ª≠ l√Ω Frontend (SPA - Single Page Application)
    # N·∫øu kh√¥ng t√¨m th·∫•y file tƒ©nh, chuy·ªÉn h∆∞·ªõng v·ªÅ index.html (cho Router c·ªßa React/Vue)
    location / {
        try_files $uri $uri/ /index.html;
    }
}